<dom-module id="augean-console">
    <template>
        <style>
            :host {
                display: block;
            }

            #api-docs-container {
                padding: 10px;
            }

            .middle {
                --paper-input-container-color: white;
                --paper-input-container-input-color: white;
                pointer-events: auto !important;
            }

            #spinner-container {
                position: absolute;
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        </style>

        <div>
            <template id="image" is="ags-object-template" as="image" predicate="http://schema.org/image" compact-with='{ "@vocab": "http://schema.org/" }'>
                <img src="[[image.thumbnail.contentUrl]]" />
            </template>

            <template id="actions" scope="resource-card-actions" is="ags-object-template" as="image" predicate="http://schema.org/image" compact-with='{ "@vocab": "http://schema.org/" }'>
                <a href="[[image.contentUrl]]" target="_blank">
                    <iron-icon icon="icons:zoom-in"></iron-icon>
                </a>
            </template>
        </div>

        <console-templates></console-templates>
        <hydra-templates></hydra-templates>
        <fallback-templates></fallback-templates>

        <ld-navigator on-resource-url-changed="urlChanged"></ld-navigator>
        <ld-navigation-history use-hash-fragment></ld-navigation-history>

        <paper-multidrawer-panel id="drawerPanel"
                                 force-right-drawer-temporary="true"
                                 disable-right-edge-swipe="true"
                                 right-drawer-width="400px">

            <paper-header-panel left-drawer class="flex">
                <paper-toolbar class="medium-tall">
                    <div class="title">Options</div>

                    <entrypoint-selector class="middle" url="{{url}}" on-url-changed="_focusUrlInput">
                        <span data-url="http://wikibus-test.gear.host/">Bus encyclopedia</span>
                        <span data-url="http://www.markus-lanthaler.com/hydra/api-demo/">Hydra demo API</span>
                    </entrypoint-selector>
                </paper-toolbar>
            </paper-header-panel>

            <paper-header-panel right-drawer>
                <paper-toolbar>
                    <div class="title">Documentation</div>
                </paper-toolbar>
                <div id="api-docs-container">
                    <api-documentation-viewer id="apiDocumentation" api-docs="[[model.apiDocumentation]]"
                                              model-types="[[currentModel.types]]"></api-documentation-viewer>
                </div>
            </paper-header-panel>

            <paper-header-panel main>
                <paper-toolbar class="medium-tall">
                    <span class="title">Augean Hydra Console</span>
                    <paper-icon-button icon="icons:help-outline"
                                       hidden$="[[!hasApiDocumentation]]"
                                       on-tap="showDocs"></paper-icon-button>

                    <paper-input id="resource" class="middle title" label="address"
                                 pattern="^https?://.*" no-label-float auto-validate
                                 invalid="{{addressInvalid}}"
                                 value="[[url]]"
                                 on-keydown="loadOnEnter">
                        <iron-icon prefix icon="icons:language"></iron-icon>
                    </paper-input>
                    <iron-a11y-keys target="[[urlInput]]" keys="enter" on-keys-pressed="onEnter"></iron-a11y-keys>
                    <paper-icon-button class="middle" icon="av:play-circle-filled" disabled="[[addressInvalid]]"
                                       on-tap="load"></paper-icon-button>
                </paper-toolbar>

                <iron-pages attr-for-selected="data-state" selected="[[state]]">
                    <div data-state="ready">
                        Hello
                    </div>

                    <div id="spinner-container" data-state="loading">
                        <paper-spinner active></paper-spinner>
                    </div>

                    <div data-state="loaded">
                        <iron-meta key="apiDocs" value="[[displayedModel.apiDocumentation]]"></iron-meta>
                        <ags-view object="[[displayedModel]]"></ags-view>

                        <operation-selector operations="[[displayedModel.operations]]" on-operation-selected="showOperationForm"
                                            operation="{{operation}}"></operation-selector>
                    </div>

                    <div data-state="operation">
                        <ags-hydra-adapter id="hydraAdapter" contract="{{contract}}" operation="[[operation]]"></ags-hydra-adapter>
                        <ags-form contract="{{contract}}"></ags-form>

                        <paper-button on-tap="hideOperationForm">Cancel</paper-button>
                        <paper-button on-tap="executeOperation">Submit</paper-button>
                    </div>

                    <div data-state="error">
                        An error occurred:
                        <p>[[lastError]]</p>
                    </div>
                </iron-pages>
            </paper-header-panel>
        </paper-multidrawer-panel>

    </template>
</dom-module>
