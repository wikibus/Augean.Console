<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="./supported-classes/supported-class-view.html">
<dom-module id="api-documentation-viewer">
  <template>
    <style>
      viewer.cs
    </style>
    <vaadin-combo-box id="classSelect" label="Supported Class" item-value-path="id" item-label-path="title" items="[[apiDocs.classes]]" selected-item="{{selectedClass}}">
    </vaadin-combo-box>

    <supported-class-view supported-class="{{selectedClass}}" hidden$="[[!classFound]]" on-class-selected="onClassSelected"></supported-class-view>

    <paper-toast id="toast" text="Class not found" duration="0" on-tap="closeToast"></paper-toast>
  </template>
  <script>
    class ApiDocumentationViewer extends Polymer.Element {
      static get is() {
        return 'api-documentation-viewer';
      }
      static get observers() {
        return [
          'selectCurrentClass(apiDocs, modelTypes)'
        ];
      }
      static get properties() {
        return {
          apiDocs: Object,
          modelTypes: {
            type: Array,
            value: function() {
              return [];
            }
          },
          selectedClass: Object,
          classFound: {
            type: Boolean,
            computed: '_classFoundComputed(selectedClass)'
          }
        };
      }
      _classFoundComputed(selectedClass) {
        return !!selectedClass;
      }
      selectClass(classId) {
        if (!this.apiDocs || !this.apiDocs.classes)
          return;
        const clazz = this.apiDocs.classes.find((c) => {
          return c.id === classId;
        });
        selectClass.call(this, clazz);
      }
      onClassSelected(e) {
        this.selectClass(e.detail.classId);
        e.preventDefault();
      }
      selectCurrentClass(apiDocs, types) {
        if (!apiDocs || !apiDocs.classes)
          return;
        const clazz = apiDocs.classes.find((c) => {
          return types.some((t) => c.id === t);
        });
        selectClass.call(this, clazz);
      }
      isCurrent(typeId) {
        return this.modelTypes.some((t) => {
          return t === typeId;
        });
      }
      closeToast() {
        this.$.toast.close();
      }
    }
    customElements.define(ApiDocumentationViewer.is, ApiDocumentationViewer);

    function selectClass(clas) {
      this.selectedClass = clas;
      if (!clas) {
        this.$.toast.open();
        this.$.classSelect.value = null;
      } else {
        this.$.toast.close();
        this.$.classSelect.value = clas.id;
      }
    }
  </script>
</dom-module>
